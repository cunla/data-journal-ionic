<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Blood results</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-segment (ionChange)="segmentChanged($event)" [value]="groupby">
    <ion-segment-button value="type">
      <ion-label>By test type</ion-label>
    </ion-segment-button>
    <ion-segment-button value="date">
      <ion-label>By test date</ion-label>
    </ion-segment-button>
  </ion-segment>
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <ion-fab horizontal="end" slot="fixed" vertical="top">
    <ion-fab-button (click)="presentAddModal(newResult)">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <ion-list>
      <ion-card *ngFor="let header of headers">
        <ion-card-title> {{header}} results</ion-card-title>
        <ion-card-content>
          <ion-segment *ngIf="groupby !== 'date'"
                       (ionChange)="graphOrList(header,$event)"
                       [value]="this.graphOrListMap[header] || 'list'">
            <ion-segment-button value="chart">
              <ion-label>Graph</ion-label>
            </ion-segment-button>
            <ion-segment-button value="list">
              <ion-label>List</ion-label>
            </ion-segment-button>
          </ion-segment>
          <div *ngIf="groupby === 'date' || this.graphOrListMap[header] !== 'chart'">
            <ion-item-sliding *ngFor="let item of data.get(header)">
              <ion-item>
                <ion-label>{{ groupby === 'date' ? item.type : (item.date | date: 'yyyy-MM-dd')}}</ion-label>
                <ion-badge slot="end" [color]="itemBadgeColor(item)">
                  {{item.value}}
                </ion-badge>
                <app-bioresultbar [value]="item.value"
                                  [high]="item.metadata.high"
                                  [low]="item.metadata.low">
                </app-bioresultbar>
              </ion-item>
              <ion-item-options side="end">
                <ion-item-option (click)="presentEditModal(item)" color="primary">
                  <ion-icon name="create-outline" slot="icon-only"></ion-icon>
                </ion-item-option>
                <ion-item-option (click)="delete(item)" color="danger">
                  <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
                </ion-item-option>
              </ion-item-options>
            </ion-item-sliding>
          </div>
          <app-resultchart *ngIf="groupby !== 'date' && this.graphOrListMap[header]==='chart'"
                           [chartData]="data.get(header)"
                           [title]="header">
          </app-resultchart>
        </ion-card-content>
      </ion-card>
  </ion-list>

</ion-content>
